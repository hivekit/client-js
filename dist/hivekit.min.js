var b=class{constructor(){this.listener={},this.listenerId=0}on(e,t,s,n){return this.listenerId++,this.listener[e]||(this.listener[e]=[]),this.listener[e].push({eventName:e,fn:t,context:s,order:n,id:this.listenerId}),this.listener[e].sort((o,a)=>o.order==a.order?0:o.order>a.order?1:-1),this.listenerId}off(e,t,s){if(!!this.listener[e]){for(var n=this.listener[e].length;n--;)this.listener[e][n].fn===t&&this.listener[e][n].context===s&&this.listener[e].splice(n,1);this.listener[e].length===0&&delete this.listener[e]}}removeListenerById(e,t){if(!this.listener[e])throw new Error("No listener registered for eventname "+e);var s=!1;if(this.listener[e]=this.listener[e].filter(n=>n.id===t?(s=!0,!1):!0),!s)throw new Error(`Failed to find listener with id ${t} for event ${e}`)}emit(e){if(!this.listener[e])return;let t=Array.prototype.slice.call(arguments,1);for(var s=null,n=0;this.listener[e]&&this.listener[e][n];){if(s=this.listener[e][n],this.listener[e][n].fn.apply(this.listener[e][n].context,t)===!1)return;this.listener[e]&&this.listener[e][n]===s&&n++}}hasListeners(e){return!!(this.listener[e]&&this.listener[e].length>0)}};var g={CONNECTION_STATUS:{CONNECTED:{VAL:"connected"},DISCONNECTED:{VAL:"disconnected"},CONNECTING:{VAL:"connecting"},DISCONNECTING:{VAL:"disconnecting"},AUTHENTICATED:{VAL:"authenticated"}},MODE:{HTTP:{VAL:"http"},WS:{VAL:"ws"}},TYPE:{REALM:{VAL:"rea",FULL:"realm"},OBJECT:{VAL:"obj",FULL:"object"},AREA:{VAL:"are",FULL:"area"},SUBSCRIPTION:{VAL:"sub",FULL:"subscription"},SYSTEM:{VAL:"sys",FULL:"system"},INSTRUCTION:{VAL:"ins",FULL:"instruction"},LOGEVENT:{VAL:"log",FULL:"logEvent"},HISTORY:{VAL:"his",FULL:"history"},TASK:{VAL:"tsk",FULL:"task"}},TASK_STATUS:{NOT_STARTED:{VAL:"$hkt_not_started"},IN_PROGRESS:{VAL:"$hkt_in_progress"},COMPLETED:{VAL:"$hkt_completed"},FAILED:{VAL:"$hkt_failed"},CANCELED:{VAL:"$hkt_canceled"},PAUSED:{VAL:"$hkt_paused"},BLOCKED:{VAL:"$hkt_blocked"}},ERROR:{CONNECTION_ERROR:{VAL:"connection_error"},MAX_RECONNECT_ATTEMPTS_EXCEEDED:{VAL:"max_reconnect_attempts_exceeded"},MESSAGE_PARSE_ERROR:{VAL:"message_parse_error"},UNKNOWN_REQUEST:{VAL:"unknown_request"},UNKNOWN_TYPE:{VAL:"unknown_type"},SERVER_ERROR:{VAL:"server_error"},UNKNOWN_FIELD:{VAL:"unknown_field"},UNKNOWN_ACTION:{VAL:"unknown_action"},UNKNOWN_SUBSCRIPTION:{VAL:"unknown_subscription"},DISCONNECTED_RETRYING:{VAL:"disconnected_retrying"}},UPDATE_TYPE:{FULL:{VAL:"ful"},DELTA:{VAL:"dta"}},FIELD:{TYPE:{VAL:"typ",FULL:"type"},SCOPE_TYPE:{VAL:"sty",FULL:"scopeType"},SUB_TYPE:{VAL:"sty",FULL:"scopeType"},SCOPE_ID:{VAL:"sid",FULL:"scopeId"},EXECUTE_IMMEDIATELY:{VAL:"exe",FULL:"executeImmediately"},ACTION:{VAL:"act",FULL:"action"},RESULT:{VAL:"res",FULL:"result"},CORRELATION_ID:{VAL:"cid",FULL:"correlationId"},ID:{VAL:"id",FULL:"id"},REALM:{VAL:"rea",FULL:"realm"},DATA:{VAL:"dat",FULL:"data"},LOCATION:{VAL:"loc",FULL:"location"},ERROR:{VAL:"err",FULL:"error"},LABEL:{VAL:"lab",FULL:"label"},ATTRIBUTE:{VAL:"atr",FULL:["attribute","where"]},UPDATE_TYPE:{VAL:"uty"},INSTRUCTION_STRING:{VAL:"ins",FULL:"instructionString"},PRESENCE_CONNECTION_STATUS:{VAL:"cst",FULL:"connectionStatus"},SHAPE:{VAL:"sha",FULL:"shape"},SHAPE_DATA:{VAL:"shapeData",FULL:"shapeData"},FIELD:{VAL:"fie",FULL:"field"},VALUE:{VAL:"val",FULL:"value"},SUBSCRIPTION_TARGET:{VAL:"sta",FULL:"start"},START:{VAL:"sta",FULL:"start"},END:{VAL:"end",FULL:"end"},LEVEL:{VAL:"lvl",FULL:"level"},EVENT_NAME:{VAL:"eve"},ID_PATTERN:{VAL:"idp"},ERROR_CODE:{VAL:"erc"},INTERVAL:{VAL:"int",FULL:"interval"},TIME:{VAL:"tim",FULL:"time"},SCOPE_TYPE_TARGET:{VAL:"tar"},RADIUS:{VAL:"r"},STATUS:{VAL:"sts",FULL:"status"},STEPS:{VAL:"stp",FULL:"steps"},DESCRIPTION:{VAL:"dsc",FULL:"description"},TARGET_ID:{VAL:"tid",FULL:"targetId"},TASK_IDS:{VAL:"tds",FULL:"taskIds"}},ACTION:{CREATE:{VAL:"cre",FULL:"create"},READ:{VAL:"rea",FULL:"read"},LIST:{VAL:"lis",FULL:"list"},UPDATE:{VAL:"upd",FULL:"update"},DELETE:{VAL:"del",FULL:"delete"},AUTHENTICATE:{VAL:"aut",FULL:"authenticate"},SET:{VAL:"set",FULL:"set"},SEARCH:{VAL:"sea"},HEARTBEAT:{VAL:"hbt"},SUBSCRIBE:{VAL:"sub"},UNSUBSCRIBE:{VAL:"uns"},PUBLISH:{VAL:"pub"},GET_STATS:{VAL:"sta"}},RESULT:{SUCCESS:{VAL:"suc",FULL:"success"},WARNING:{VAL:"war",FULL:"warning"},ERROR:{VAL:"err",FULL:"error"}},SUBSCRIPTION:{REALM:{VAL:"all-realms"}},LOCATION:{GEOGRAPHIC_COORDINATE_SYSTEM:{VAL:"gcs",FULL:"coordinateSystem"},LONGITUDE:{VAL:"lon",FULL:"longitude"},LATITUDE:{VAL:"lat",FULL:"latitude"},ACCURACY:{VAL:"acc",FULL:"accuracy"},SPEED:{VAL:"spe",FULL:"speed"},HEADING:{VAL:"hea",FULL:"heading"},ALTITUDE:{VAL:"alt",FULL:"altitude"},ALTITUDE_ACCURACY:{VAL:"alc",FULL:"altitudeAccuracy"},TIME:{VAL:"tim",FULL:"time"}},SHAPE_TYPE:{RECTANGLE:{VAL:"rec",FULL:"rectangle"},CIRCLE:{VAL:"cir",FULL:"circle"},POLYGON:{VAL:"pol",FULL:"polygon"}},PRESENCE_CONNECTION_STATUS:{CONNECTED:{VAL:"con",FULL:"connected"},DISCONNECTED:{VAL:"dis",FULL:"disconnected"}}},i=function(){let r={};for(let e in g){r[e]={};for(let t in g[e])r[e][t]=g[e][t].VAL}return r}(),A=function(){let e={};for(let t in g){let s={};for(let n in g[t])g[t][n].FULL&&(s[g[t][n].VAL]=g[t][n].FULL);Object.keys(s).length>0&&(e[t]=s)}return e}();function p(r,e,t,s,n,o){let a={[i.FIELD.TYPE]:r,[i.FIELD.ACTION]:e};return t&&(a[i.FIELD.ID]=t),s&&(a[i.FIELD.REALM]=s),n&&(a[i.FIELD.DATA]=n),o&&(a[i.FIELD.LOCATION]=o),a}var re=class{constructor(e){this._client=e,this._systemUpdateSubscription=null}getHttpRoot(){if(this._client.options.httpRoot)return this._client.options.httpRoot;let e=this._client._url||(typeof document=="undefined"?null:document.location.href);if(!e)return null;var t;try{t=new URL(e)}catch{return null}return(t.protocol==="wss:"||t.protocol==="https:"?"https":"http")+"://"+t.host}authenticateAdmin(e){return new Promise(async(t,s)=>{let n=this.getHttpRoot();if(!n){s(new Error("no http url found"));return}let o=n+this._client.options.adminDashboardBasePath+"api/authenticate-admin";var a;try{a=await fetch(o,{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({username:"admin",password:e})})}catch(l){s(l.message);return}if(a.status===200)t();else{let l=await a.json();s(new Error(l[0][i.FIELD.ERROR]))}})}getServerStats(){let e=p(i.TYPE.SYSTEM,i.ACTION.GET_STATS);return this._client._sendRequestAndHandleResponse(e,t=>t[i.FIELD.DATA])}_sendAuthMessage(e){this._client._connection.readyState===this._client._connection.constructor.OPEN?this._client._connection.send("Bearer "+e):this._client._connection.addEventListener("open",()=>{this._client._connection.send("Bearer "+e)})}_handleIncomingMessage(e){switch(e[i.FIELD.ACTION]){case i.ACTION.AUTHENTICATE:e[i.FIELD.RESULT]===i.RESULT.SUCCESS&&(e[i.FIELD.DATA]&&(this._client.serverVersion=e[i.FIELD.DATA].version,this._client.serverBuildDate=e[i.FIELD.DATA].buildDate),this._client._changeConnectionStatus(i.CONNECTION_STATUS.AUTHENTICATED),this._client._onAuthenticatePromise&&this._client._onAuthenticatePromise.resolve()),e[i.FIELD.RESULT]===i.RESULT.ERROR&&this._client._onAuthenticatePromise&&this._client._onAuthenticatePromise.reject(e[i.FIELD.ERROR]);break;default:this._client._onError(`Unknown action for type ${i.TYPE.SYSTEM}: ${e[i.FIELD.ACTION]}`,i.ERROR.UNKNOWN_ACTION)}}};function x(){var r,e;let t=new Promise((s,n)=>{r=s,e=n});return t.resolve=r,t.reject=e,t}function Xe(r){let e={};for(var t in r)r[t]instanceof Array?r[t].forEach(s=>{e[s]=t}):e[r[t]]=t;return e}function D(r,e){for(var t in e)r[t]=e[t];return r}function H(r){return JSON.parse(JSON.stringify(r))}var Qe={x1x2y1y2:i.SHAPE_TYPE.RECTANGLE,cxcyr:i.SHAPE_TYPE.CIRCLE,points:i.SHAPE_TYPE.POLYGON};function V(r){var e=Object.keys(r).sort().join("");return e==="eastnorthsouthwest"&&(r={x1:r.west,y1:r.south,x2:r.east,y2:r.north},e="x1x2y1y2"),Qe[e]?{type:Qe[e],data:r,err:null}:{err:"unknown shape data"}}function Pe(r){return r instanceof Date&&r.toString()!="Invalid Date"}var be={};for(ge in A.LOCATION)be[A.LOCATION[ge]]=ge;var ge;function se(r){let e={};for(var t in r)if(t.length!==0){if(typeof r[t]!="string"){e[be[t]]=r[t];continue}if(r[t].length>0)if(t===A.LOCATION[i.LOCATION.TIME])try{e[t]=new Date(r[t]).toISOString()}catch(s){throw new Error(`Can't convert ${r[t]} into a valid date:${s}`)}else e[be[t]]=parseFloat(r[t])}return e}var ne=class{constructor(e,t){this._client=e,this._realm=t}subscribe(e){if(e=e||{},e.shape){let t=V(e.shape);if(t.err)return Promise.reject(t.err);e.scopeType=t.type,e.shape=t.data}return e.target&&(e[i.FIELD.SUBSCRIPTION_TARGET]=e.target,e[i.FIELD.SCOPE_TYPE]=i.FIELD.SCOPE_TYPE_TARGET,delete e.target),this._client._subscription._getSubscription(this._client.getId("object-subscription"),this._realm.id,D({[i.FIELD.TYPE]:i.TYPE.OBJECT,[i.FIELD.SCOPE_TYPE]:i.TYPE.REALM},this._client._compressFields(e,A.FIELD,!0)))}get(e){if(!e)throw new Error("no id provided for object.get");let t=p(i.TYPE.OBJECT,i.ACTION.READ,e,this._realm.id);return this._client._sendRequestAndHandleResponse(t,s=>{let n=this._client._extendFields(s[i.FIELD.DATA]);return n.data=n.data||{},n.taskIds=n.taskIds||[],n})}create(e,t){return this._setObjectState(e,t.label,t.location,t.data,t.taskIds,i.ACTION.CREATE)}update(e,t){return this._setObjectState(e,t.label,t.location,t.data,t.taskIds,i.ACTION.UPDATE)}set(e,t){return this._setObjectState(e,t.label,t.location,t.data,t.taskIds,i.ACTION.SET)}list(e){let t=p(i.TYPE.OBJECT,i.ACTION.LIST,null,this._realm.id);return e&&Object.keys(e).length>0&&(t[i.FIELD.DATA]=this._client._compressFields(e,A.FIELD)),this._client._sendRequestAndHandleResponse(t,s=>this._client._extendFieldsMap(s[i.FIELD.DATA]))}delete(e){let t=p(i.TYPE.OBJECT,i.ACTION.DELETE,e,this._realm.id);return this._client._sendRequestAndHandleResponse(t)}_setObjectState(e,t,s,n,o,a){let l=p(i.TYPE.OBJECT,a,e,this._realm.id);if(t&&(l[i.FIELD.LABEL]=t),s&&Object.keys(s).length>0&&(l[i.FIELD.LOCATION]=se(s)),n&&Object.keys(n).length>0&&(l[i.FIELD.DATA]=n),Array.isArray(o)&&(l[i.FIELD.TASK_IDS]=o),a===i.ACTION.SET&&this._client.mode!==i.MODE.HTTP)this._client._sendMessage(l);else return this._client._sendRequestAndHandleResponse(l)}};var ie=class{constructor(e,t){this._client=e,this._realm=t}subscribe(e){return this._client._subscription._getSubscription(this._client.getId("area-subscription"),this._realm.id,D({[i.FIELD.TYPE]:i.TYPE.AREA,[i.FIELD.SCOPE_TYPE]:i.TYPE.REALM},this._client._compressFields(e,A.FIELD)))}get(e){let t=p(i.TYPE.AREA,i.ACTION.READ,e,this._realm.id);return this._client._sendRequestAndHandleResponse(t,s=>this._client._extendFields(s[i.FIELD.DATA]))}create(e,t){return this._setAreaState(e,t.label,t.shapeData||t.shape,t.data,i.ACTION.CREATE)}update(e,t){return this._setAreaState(e,t.label,t.shapeData||t.shape,t.data,i.ACTION.UPDATE)}list(){let e=p(i.TYPE.AREA,i.ACTION.LIST,null,this._realm.id);return this._client._sendRequestAndHandleResponse(e,t=>{let s=this._client._extendFieldsMap(t[i.FIELD.DATA]);for(var n in s)s[n].shape=A.SHAPE_TYPE[s[n].scopeType],delete s[n].scopeType;return s})}delete(e){let t=p(i.TYPE.AREA,i.ACTION.DELETE,e,this._realm.id);return this._client._sendRequestAndHandleResponse(t)}_setAreaState(e,t,s,n,o){let a=p(i.TYPE.AREA,o,e,this._realm.id),l=V(s);return l.err?Promise.reject(l.err):(a[i.FIELD.SUB_TYPE]=l.type,a[i.FIELD.SHAPE]=l.data,t&&(a[i.FIELD.LABEL]=t),n&&(a[i.FIELD.DATA]=n),this._client._sendRequestAndHandleResponse(a))}};var oe=class{constructor(e,t){this._client=e,this._realm=t}subscribe(e){return this._client._subscription._getSubscription(this._client.getId("instruction-subscription"),this._realm.id,D({[i.FIELD.TYPE]:i.TYPE.INSTRUCTION,[i.FIELD.SCOPE_TYPE]:i.TYPE.REALM},this._client._compressFields(e,A.FIELD)))}subscribeToLogs(e){return this._client._subscription._getSubscription(this._client.getId("instruction-log-subscription"),this._realm.id,D({[i.FIELD.TYPE]:i.TYPE.LOGEVENT,[i.FIELD.SCOPE_TYPE]:i.TYPE.REALM},this._client._compressFields(e,A.FIELD)))}get(e){let t=p(i.TYPE.INSTRUCTION,i.ACTION.READ,e,this._realm.id);return this._client._sendRequestAndHandleResponse(t,s=>this._client._extendFields(s[i.FIELD.DATA]))}create(e,t){return this._setInstructionState(e,t.label,t.instructionString,t.data,i.ACTION.CREATE)}update(e,t){return this._setInstructionState(e,t.label,t.instructionString,t.data,i.ACTION.UPDATE)}list(){let e=p(i.TYPE.INSTRUCTION,i.ACTION.LIST,null,this._realm.id);return this._client._sendRequestAndHandleResponse(e,t=>this._client._extendFieldsMap(t[i.FIELD.DATA]))}delete(e){let t=p(i.TYPE.INSTRUCTION,i.ACTION.DELETE,e,this._realm.id);return this._client._sendRequestAndHandleResponse(t)}_setInstructionState(e,t,s,n,o){let a=p(i.TYPE.INSTRUCTION,o,e,this._realm.id);return a[i.FIELD.INSTRUCTION_STRING]=s,t&&(a[i.FIELD.LABEL]=t),n&&(a[i.FIELD.DATA]=n),this._client._sendRequestAndHandleResponse(a)}};var ae=class{constructor(e,t){this._client=e,this._realm=t,this._subscriptionCallbacks=[]}subscribe(e,t,s){let n="*";arguments.length===2?s=t:n=t;let o=`${e}:${n}`,a=this._subscriptionCallbacks[o];return this._subscriptionCallbacks[o]=this._subscriptionCallbacks[o]||[],this._subscriptionCallbacks[o].push(s),a?Promise.resolve({}):this._client._sendRequestAndHandleResponse(this._getPubSubMessage(i.ACTION.SUBSCRIBE,e,n))}unsubscribe(e,t,s){let n="*",o=null;typeof t=="function"?o=t:t&&(n=t);let a=`${e}:${n}`;if(this._subscriptionCallbacks[a]){if(o){let h=this._subscriptionCallbacks[a],u=h.indexOf(o);u>-1&&h.splice(u,1)}else this._subscriptionCallbacks[a].length=0;if(this._subscriptionCallbacks[a].length===0)return delete this._subscriptionCallbacks[a],this._client._sendRequestAndHandleResponse(this._getPubSubMessage(i.ACTION.UNSUBSCRIBE,e,n))}return Promise.reject({message:"no subscription with that id pattern",code:400})}publish(e,t,s){var n;arguments.length===2?(n="*",s=t):n=t;let o=this._getPubSubMessage(i.ACTION.PUBLISH,e,n);return o[i.FIELD.DATA][i.FIELD.DATA]=s,this._client._sendRequestAndHandleResponse(o)}_emitSubscriptionEvent(e,t,s){let n=`${e}:${s}`,o=this._subscriptionCallbacks[n];if(o){["connectionStatusChanged"].includes(e)&&(t=this._client._extendFields(t));for(let a=0;a<o.length;a++)o[a](t)}}_getPubSubMessage(e,t,s){let n=p(i.TYPE.REALM,e,this._realm.id);return n[i.FIELD.DATA]={[i.FIELD.EVENT_NAME]:t,[i.FIELD.ID_PATTERN]:s||"*"},n}};var ce=class{constructor(e,t){this._client=e,this._realm=t}get(e,t){let s=p(i.TYPE.HISTORY,i.ACTION.READ,e,this._realm.id);if(!Pe(t.startTime))throw new Error("startTime is not a valid Date object");if(!Pe(t.endTime))throw new Error("endTime is not a valid Date object");return s[i.FIELD.DATA]={[i.FIELD.START]:t.startTime.toISOString(),[i.FIELD.END]:t.endTime.toISOString()},this._client._sendRequestAndHandleResponse(s,n=>n[i.FIELD.DATA].map(o=>this._client._extendFields(o)))}};var le=class{constructor(e,t){this._client=e,this._realm=t}subscribe(e){return this._client._subscription._getSubscription(this._client.getId("task-subscription"),this._realm.id,D({[i.FIELD.TYPE]:i.TYPE.TASK,[i.FIELD.SCOPE_TYPE]:i.TYPE.REALM},this._client._compressFields(e,A.FIELD)))}get(e){let t=p(i.TYPE.TASK,i.ACTION.READ,e,this._realm.id);return this._client._sendRequestAndHandleResponse(t,s=>{let n=this._client._extendFields(s[i.FIELD.DATA]);return n.steps&&(n.steps=n.steps.map(o=>this._client._extendFields(o))),n})}create(e,t){let s=t.location&&Object.keys(t.location).length>0;if(s&&t.targetId)throw new Error("Cannot set both location and targetId");if(!s&&!t.targetId)throw new Error("Task needs either a targetId or location");return this._setTaskState(e,t,i.ACTION.CREATE)}update(e,t){return this._setTaskState(e,t,i.ACTION.UPDATE)}list(){let e=p(i.TYPE.TASK,i.ACTION.LIST,null,this._realm.id);return this._client._sendRequestAndHandleResponse(e,t=>this._client._extendFieldsMap(t[i.FIELD.DATA]))}delete(e){let t=p(i.TYPE.TASK,i.ACTION.DELETE,e,this._realm.id);return this._client._sendRequestAndHandleResponse(t)}_setTaskState(e,t,s){let n=p(i.TYPE.TASK,s,e,this._realm.id);if(t.label&&(n[i.FIELD.LABEL]=t.label),t.data&&(n[i.FIELD.DATA]=t.data),t.status){if(!Object.values(i.TASK_STATUS).includes(t.status))throw new Error(`Invalid task status: ${t.status}`);n[i.FIELD.STATUS]=t.status}return t.location&&(n[i.FIELD.LOCATION]=se(t.location)),t.steps&&(n[i.FIELD.STEPS]=t.steps.map(o=>this._client._compressFields(o,A.FIELD))),t.targetId&&(n[i.FIELD.TARGET_ID]=t.targetId),t.description&&(n[i.FIELD.DESCRIPTION]=t.description),this._client._sendRequestAndHandleResponse(n)}};var ue=class extends b{constructor(e,t,s,n){super();this._client=n,this._data=s,this._subscriptionCallbacks={},this.id=e,this.label=t,this.object=new ne(n,this),this.area=new ie(n,this),this.instruction=new oe(n,this),this.pubsub=new ae(n,this),this.history=new ce(n,this),this.task=new le(n,this),n.mode!==i.MODE.HTTP&&n._subscription._getSubscription(n.getId(`realm-data-${e}`),e,{[i.FIELD.TYPE]:i.TYPE.REALM,[i.FIELD.SCOPE_TYPE]:i.TYPE.REALM}).then(o=>{this._dataSub=o,o.on("update",({data:a,label:l})=>{this._data=a,this.label=l,this.emit("update")})})}getData(e){if(this._client.mode===i.MODE.HTTP){let t=p(i.TYPE.REALM,i.ACTION.READ,this.id);return this._client._sendRequestAndHandleResponse(t,s=>{let n=s[i.FIELD.DATA][i.FIELD.DATA]||{};return e?n[e]:n})}return e?typeof this._data[e]=="object"?H(this._data[e]):this._data[e]:H(this._data)}setData(e,t){let s=p(i.TYPE.REALM,i.ACTION.UPDATE,this.id);return this._data[e]=t,s[i.FIELD.DATA]=H(this._data),t===null&&delete this._data[e],this.emit("update"),this._client._sendRequestAndHandleResponse(s)}setLabel(e){let t=p(i.TYPE.REALM,i.ACTION.UPDATE,this.id);return this.label=e,t[i.FIELD.LABEL]=e,this.emit("update"),this._client._sendRequestAndHandleResponse(t)}search(e,t){let s=this._client._compressFields(t,A.FIELD,!0);s.val=e;let n=p(i.TYPE.REALM,i.ACTION.SEARCH,null,this.id,s);return this._client._sendRequestAndHandleResponse(n,o=>o[i.FIELD.DATA]?o[i.FIELD.DATA].map(a=>{let l=this._client._extendFields(a);return l.dataProperty=l.scopeType,delete l.scopeType,l}):[])}};var de=class{constructor(e){this._client=e,this._realms={},this._useCache=e.mode!==i.MODE.HTTP}subscribe(){return this._client._subscription._getSubscription(this._client.getId("realm-subscription-"),i.TYPE.SYSTEM,{[i.FIELD.TYPE]:i.TYPE.SYSTEM,[i.FIELD.SCOPE_TYPE]:i.TYPE.REALM})}get(e){if(this._useCache&&this._realms[e])return Promise.resolve(this._realms[e]);let t=p(i.TYPE.REALM,i.ACTION.READ,e);return this._client._sendRequestAndHandleResponse(t,s=>{let n=new ue(e,s[i.FIELD.DATA][i.FIELD.LABEL],s[i.FIELD.DATA][i.FIELD.DATA]||{},this._client);return this._useCache&&(this._realms[e]=n),n})}create(e,t,s){let n=p(i.TYPE.REALM,i.ACTION.CREATE,e);return t&&(n[i.FIELD.LABEL]=t),s&&Object.keys(s).length>0&&(n[i.FIELD.DATA]=s),this._client._sendRequestAndHandleResponse(n)}list(){let e=p(i.TYPE.REALM,i.ACTION.LIST);return this._client._sendRequestAndHandleResponse(e,t=>this._client._extendFieldsMap(t.dat))}delete(e){let t=p(i.TYPE.REALM,i.ACTION.DELETE,e);return this._client._sendRequestAndHandleResponse(t)}_handleIncomingMessage(e){e[i.FIELD.ACTION]===i.ACTION.PUBLISH&&this._realms[e[i.FIELD.REALM]]&&this._realms[e[i.FIELD.REALM]].pubsub._emitSubscriptionEvent(e[i.FIELD.DATA][i.FIELD.EVENT_NAME],e[i.FIELD.DATA][i.FIELD.DATA],e[i.FIELD.SCOPE_ID])}};var ye=(r=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(r));for(;r--;){let s=t[r]&63;s<36?e+=s.toString(36):s<62?e+=(s-26).toString(36).toUpperCase():s<63?e+="_":e+="-"}return e};var j=class extends b{constructor(e,t,s){super();this.id=t,this.realmId=s,this._client=e,this._data=null}cancel(){return this.listener={},this._client._subscription._removeSubscription(this)}update(e){if(e&&e.shape){let s=V(e.shape);if(s.err)return Promise.reject(s.err);e.scopeType=s.type,e.shape=s.data}let t=p(i.TYPE.SUBSCRIPTION,i.ACTION.UPDATE,this.id,this.realmId,D({[i.FIELD.TYPE]:i.TYPE.OBJECT,[i.FIELD.SCOPE_TYPE]:i.TYPE.REALM},this._client._compressFields(e,A.FIELD)));return this._client._sendRequestAndHandleResponse(t)}_processIncomingMessage(e){if(this._data===null&&(this._data={}),e[i.TYPE.OBJECT]||e[i.TYPE.TASK]){let n=e[i.TYPE.OBJECT]||e[i.TYPE.TASK],o={added:this._client._extendFieldsMap(n[i.ACTION.CREATE]),updated:this._client._extendFieldsMap(n[i.ACTION.UPDATE]),removed:n[i.ACTION.DELETE]};e[i.FIELD.UPDATE_TYPE]===i.UPDATE_TYPE.FULL&&(this._data={});for(let a in o.added)this._data[a]=o.added[a];for(let a in o.updated)this._data[a]=o.updated[a];for(let a in o.removed)delete this._data[a];this.emit("update",this._data,o,e[i.FIELD.UPDATE_TYPE]===i.UPDATE_TYPE.FULL?"full":"delta");return}var t={};switch(e[i.TYPE.AREA]?t=this._client._extendFieldsMap(e[i.TYPE.AREA]):e[i.TYPE.INSTRUCTION]?t=this._client._extendFieldsMap(e[i.TYPE.INSTRUCTION]):e[i.TYPE.LOGEVENT]?t=this._client._extendFieldsArray(e[i.TYPE.LOGEVENT]):e[i.TYPE.REALM]?t=this._client._extendFields(e[i.TYPE.REALM]):e[i.FIELD.DATA]&&e[i.FIELD.DATA][i.FIELD.TYPE]===i.TYPE.REALM&&(t={realmId:e[i.FIELD.DATA][i.FIELD.ID],action:A.ACTION[e[i.FIELD.DATA][i.FIELD.ACTION]]}),e[i.FIELD.UPDATE_TYPE]){case i.UPDATE_TYPE.FULL:this._data=t;break;case i.UPDATE_TYPE.DELTA:for(var s in t)this._data[s]=t[s];break;default:this._client._onError("Received subscription message with unknown update type "+e[i.FIELD.UPDATE_TYPE],i.ERROR.UNKNOWN_TYPE);return}this.emit("update",this._data)}};var fe=class{constructor(e){this._client=e,this._subscriptionCollections={},this._pendingSubscriptionPromises={}}_getSubscription(e,t,s){let n=x(),o=this._client._getSignature(t,s);var a,l=this._subscriptionCollections[e];if(!l)for(var h in this._subscriptionCollections)this._subscriptionCollections[h].signature===o&&(e=h,l=this._subscriptionCollections[e]);if(l)return a=new j(this._client,e,t),l.push(a),n.resolve(a),s[i.FIELD.EXECUTE_IMMEDIATELY]&&this._invokeImmediatly(a),n;if(e||(e=this.getId(this.constants.TYPE.SUBSCRIPTION)),a=new j(this._client,e,t),this._subscriptionCollections[e]=[a],this._subscriptionCollections[e].signature=o,this._pendingSubscriptionPromises[o])return this._pendingSubscriptionPromises[o].push({resultPromise:n,subscription:a}),n;this._pendingSubscriptionPromises[o]=[{resultPromise:n,subscription:a}];let u=p(i.TYPE.SUBSCRIPTION,i.ACTION.CREATE,e,t,s);return this._client._sendRequest(u,d=>{d[i.FIELD.RESULT]===i.RESULT.SUCCESS?this._pendingSubscriptionPromises[o].forEach(E=>{E.resultPromise.resolve(E.subscription)}):this._pendingSubscriptionPromises[o].forEach(E=>{E.resultPromise.reject(d[i.FIELD.ERROR])}),delete this._pendingSubscriptionPromises[o]}),n}_removeSubscription(e){if(!this._subscriptionCollections[e.id])throw new Error("Can`t remove unknown subscription "+e.id);if(!this._subscriptionCollections[e.id].includes(e))throw new Error("Subscription not found for id "+e.id);if(this._subscriptionCollections[e.id]=this._subscriptionCollections[e.id].filter(s=>e!==s),this._subscriptionCollections[e.id].length>0)return new Promise(s=>{s()});let t=p(i.TYPE.SUBSCRIPTION,i.ACTION.DELETE,e.id,e.realmId);return delete this._subscriptionCollections[e.id],this._client._sendRequestAndHandleResponse(t)}_handleIncomingMessage(e){let t=e[i.FIELD.ID];if(!this._subscriptionCollections[t])this._client._onError("Received message for unknown subscription "+e,i.ERROR.UNKNOWN_SUBSCRIPTION);else for(var s=0;s<this._subscriptionCollections[t].length&&(this._subscriptionCollections[t][s]._processIncomingMessage(e),!!this._subscriptionCollections[t]);s++);}_invokeImmediatly(e){if(!!this._subscriptionCollections[e.id]){var t=null,s;for(s=0;s<this._subscriptionCollections[e.id].length;s++)if(this._subscriptionCollections[e.id][s]._data){t=this._subscriptionCollections[e.id][s]._data;break}t&&setTimeout(()=>{e._data=H(t),e.emit("update",e._data)},1)}}};function q(r,e){return function(){return r.apply(e,arguments)}}var{toString:wt}=Object.prototype,{getPrototypeOf:we}=Object,he=(r=>e=>{let t=wt.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),N=r=>(r=r.toLowerCase(),e=>he(e)===r),Ee=r=>e=>typeof e===r,{isArray:Y}=Array,v=Ee("undefined");function Ut(r){return r!==null&&!v(r)&&r.constructor!==null&&!v(r.constructor)&&O(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}var Ze=N("ArrayBuffer");function xt(r){let e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&Ze(r.buffer),e}var Mt=Ee("string"),O=Ee("function"),et=Ee("number"),pe=r=>r!==null&&typeof r=="object",Ht=r=>r===!0||r===!1,me=r=>{if(he(r)!=="object")return!1;let e=we(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},Vt=N("Date"),Yt=N("File"),Bt=N("Blob"),kt=N("FileList"),jt=r=>pe(r)&&O(r.pipe),qt=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||O(r.append)&&((e=he(r))==="formdata"||e==="object"&&O(r.toString)&&r.toString()==="[object FormData]"))},vt=N("URLSearchParams"),Jt=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function J(r,e,{allOwnKeys:t=!1}={}){if(r===null||typeof r=="undefined")return;let s,n;if(typeof r!="object"&&(r=[r]),Y(r))for(s=0,n=r.length;s<n;s++)e.call(null,r[s],s,r);else{let o=t?Object.getOwnPropertyNames(r):Object.keys(r),a=o.length,l;for(s=0;s<a;s++)l=o[s],e.call(null,r[l],l,r)}}function tt(r,e){e=e.toLowerCase();let t=Object.keys(r),s=t.length,n;for(;s-- >0;)if(n=t[s],e===n.toLowerCase())return n;return null}var rt=(()=>typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global)(),st=r=>!v(r)&&r!==rt;function Ue(){let{caseless:r}=st(this)&&this||{},e={},t=(s,n)=>{let o=r&&tt(e,n)||n;me(e[o])&&me(s)?e[o]=Ue(e[o],s):me(s)?e[o]=Ue({},s):Y(s)?e[o]=s.slice():e[o]=s};for(let s=0,n=arguments.length;s<n;s++)arguments[s]&&J(arguments[s],t);return e}var Gt=(r,e,t,{allOwnKeys:s}={})=>(J(e,(n,o)=>{t&&O(n)?r[o]=q(n,t):r[o]=n},{allOwnKeys:s}),r),Kt=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),Wt=(r,e,t,s)=>{r.prototype=Object.create(e.prototype,s),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),t&&Object.assign(r.prototype,t)},$t=(r,e,t,s)=>{let n,o,a,l={};if(e=e||{},r==null)return e;do{for(n=Object.getOwnPropertyNames(r),o=n.length;o-- >0;)a=n[o],(!s||s(a,r,e))&&!l[a]&&(e[a]=r[a],l[a]=!0);r=t!==!1&&we(r)}while(r&&(!t||t(r,e))&&r!==Object.prototype);return e},zt=(r,e,t)=>{r=String(r),(t===void 0||t>r.length)&&(t=r.length),t-=e.length;let s=r.indexOf(e,t);return s!==-1&&s===t},Xt=r=>{if(!r)return null;if(Y(r))return r;let e=r.length;if(!et(e))return null;let t=new Array(e);for(;e-- >0;)t[e]=r[e];return t},Qt=(r=>e=>r&&e instanceof r)(typeof Uint8Array!="undefined"&&we(Uint8Array)),Zt=(r,e)=>{let s=(r&&r[Symbol.iterator]).call(r),n;for(;(n=s.next())&&!n.done;){let o=n.value;e.call(r,o[0],o[1])}},er=(r,e)=>{let t,s=[];for(;(t=r.exec(e))!==null;)s.push(t);return s},tr=N("HTMLFormElement"),rr=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,s,n){return s.toUpperCase()+n}),nt=(({hasOwnProperty:r})=>(e,t)=>r.call(e,t))(Object.prototype),sr=N("RegExp"),it=(r,e)=>{let t=Object.getOwnPropertyDescriptors(r),s={};J(t,(n,o)=>{let a;(a=e(n,o,r))!==!1&&(s[o]=a||n)}),Object.defineProperties(r,s)},nr=r=>{it(r,(e,t)=>{if(O(r)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;let s=r[t];if(!!O(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},ir=(r,e)=>{let t={},s=n=>{n.forEach(o=>{t[o]=!0})};return Y(r)?s(r):s(String(r).split(e)),t},or=()=>{},ar=(r,e)=>(r=+r,Number.isFinite(r)?r:e),xe="abcdefghijklmnopqrstuvwxyz",ot="0123456789",at={DIGIT:ot,ALPHA:xe,ALPHA_DIGIT:xe+xe.toUpperCase()+ot},cr=(r=16,e=at.ALPHA_DIGIT)=>{let t="",{length:s}=e;for(;r--;)t+=e[Math.random()*s|0];return t};function lr(r){return!!(r&&O(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}var ur=r=>{let e=new Array(10),t=(s,n)=>{if(pe(s)){if(e.indexOf(s)>=0)return;if(!("toJSON"in s)){e[n]=s;let o=Y(s)?[]:{};return J(s,(a,l)=>{let h=t(a,n+1);!v(h)&&(o[l]=h)}),e[n]=void 0,o}}return s};return t(r,0)},dr=N("AsyncFunction"),fr=r=>r&&(pe(r)||O(r))&&O(r.then)&&O(r.catch),c={isArray:Y,isArrayBuffer:Ze,isBuffer:Ut,isFormData:qt,isArrayBufferView:xt,isString:Mt,isNumber:et,isBoolean:Ht,isObject:pe,isPlainObject:me,isUndefined:v,isDate:Vt,isFile:Yt,isBlob:Bt,isRegExp:sr,isFunction:O,isStream:jt,isURLSearchParams:vt,isTypedArray:Qt,isFileList:kt,forEach:J,merge:Ue,extend:Gt,trim:Jt,stripBOM:Kt,inherits:Wt,toFlatObject:$t,kindOf:he,kindOfTest:N,endsWith:zt,toArray:Xt,forEachEntry:Zt,matchAll:er,isHTMLForm:tr,hasOwnProperty:nt,hasOwnProp:nt,reduceDescriptors:it,freezeMethods:nr,toObjectSet:ir,toCamelCase:rr,noop:or,toFiniteNumber:ar,findKey:tt,global:rt,isContextDefined:st,ALPHABET:at,generateString:cr,isSpecCompliantForm:lr,toJSONObject:ur,isAsyncFn:dr,isThenable:fr};function B(r,e,t,s,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),s&&(this.request=s),n&&(this.response=n)}c.inherits(B,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:c.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var ct=B.prototype,lt={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{lt[r]={value:r}});Object.defineProperties(B,lt);Object.defineProperty(ct,"isAxiosError",{value:!0});B.from=(r,e,t,s,n,o)=>{let a=Object.create(ct);return c.toFlatObject(r,a,function(h){return h!==Error.prototype},l=>l!=="isAxiosError"),B.call(a,r.message,e,t,s,n),a.cause=r,a.name=r.name,o&&Object.assign(a,o),a};var m=B;var Te=null;function Me(r){return c.isPlainObject(r)||c.isArray(r)}function ut(r){return c.endsWith(r,"[]")?r.slice(0,-2):r}function dt(r,e,t){return r?r.concat(e).map(function(n,o){return n=ut(n),!t&&o?"["+n+"]":n}).join(t?".":""):e}function hr(r){return c.isArray(r)&&!r.some(Me)}var Er=c.toFlatObject(c,{},null,function(e){return/^is[A-Z]/.test(e)});function pr(r,e,t){if(!c.isObject(r))throw new TypeError("target must be an object");e=e||new(Te||FormData),t=c.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(T,F){return!c.isUndefined(F[T])});let s=t.metaTokens,n=t.visitor||d,o=t.dots,a=t.indexes,h=(t.Blob||typeof Blob!="undefined"&&Blob)&&c.isSpecCompliantForm(e);if(!c.isFunction(n))throw new TypeError("visitor must be a function");function u(f){if(f===null)return"";if(c.isDate(f))return f.toISOString();if(!h&&c.isBlob(f))throw new m("Blob is not supported. Use a Buffer instead.");return c.isArrayBuffer(f)||c.isTypedArray(f)?h&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function d(f,T,F){let C=f;if(f&&!F&&typeof f=="object"){if(c.endsWith(T,"{}"))T=s?T:T.slice(0,-2),f=JSON.stringify(f);else if(c.isArray(f)&&hr(f)||(c.isFileList(f)||c.endsWith(T,"[]"))&&(C=c.toArray(f)))return T=ut(T),C.forEach(function(te,yt){!(c.isUndefined(te)||te===null)&&e.append(a===!0?dt([T],yt,o):a===null?T:T+"[]",u(te))}),!1}return Me(f)?!0:(e.append(dt(F,T,o),u(f)),!1)}let E=[],R=Object.assign(Er,{defaultVisitor:d,convertValue:u,isVisitable:Me});function _(f,T){if(!c.isUndefined(f)){if(E.indexOf(f)!==-1)throw Error("Circular reference detected in "+T.join("."));E.push(f),c.forEach(f,function(C,M){(!(c.isUndefined(C)||C===null)&&n.call(e,C,c.isString(M)?M.trim():M,T,R))===!0&&_(C,T?T.concat(M):[M])}),E.pop()}}if(!c.isObject(r))throw new TypeError("data must be an object");return _(r),e}var y=pr;function ft(r){let e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function ht(r,e){this._pairs=[],r&&y(r,this,e)}var Et=ht.prototype;Et.append=function(e,t){this._pairs.push([e,t])};Et.toString=function(e){let t=e?function(s){return e.call(this,s,ft)}:ft;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};var Ae=ht;function mr(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function G(r,e,t){if(!e)return r;let s=t&&t.encode||mr,n=t&&t.serialize,o;if(n?o=n(e,t):o=c.isURLSearchParams(e)?e.toString():new Ae(e,t).toString(s),o){let a=r.indexOf("#");a!==-1&&(r=r.slice(0,a)),r+=(r.indexOf("?")===-1?"?":"&")+o}return r}var pt=class{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){c.forEach(this.handlers,function(s){s!==null&&e(s)})}},He=pt;var _e={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};var mt=typeof URLSearchParams!="undefined"?URLSearchParams:Ae;var Tt=typeof FormData!="undefined"?FormData:null;var At=typeof Blob!="undefined"?Blob:null;var Tr=(()=>{let r;return typeof navigator!="undefined"&&((r=navigator.product)==="ReactNative"||r==="NativeScript"||r==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"})(),Ar=(()=>typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),I={isBrowser:!0,classes:{URLSearchParams:mt,FormData:Tt,Blob:At},isStandardBrowserEnv:Tr,isStandardBrowserWebWorkerEnv:Ar,protocols:["http","https","file","blob","url","data"]};function Ve(r,e){return y(r,new I.classes.URLSearchParams,Object.assign({visitor:function(t,s,n,o){return I.isNode&&c.isBuffer(t)?(this.append(s,t.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function _r(r){return c.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Lr(r){let e={},t=Object.keys(r),s,n=t.length,o;for(s=0;s<n;s++)o=t[s],e[o]=r[o];return e}function Rr(r){function e(t,s,n,o){let a=t[o++],l=Number.isFinite(+a),h=o>=t.length;return a=!a&&c.isArray(n)?n.length:a,h?(c.hasOwnProp(n,a)?n[a]=[n[a],s]:n[a]=s,!l):((!n[a]||!c.isObject(n[a]))&&(n[a]=[]),e(t,s,n[a],o)&&c.isArray(n[a])&&(n[a]=Lr(n[a])),!l)}if(c.isFormData(r)&&c.isFunction(r.entries)){let t={};return c.forEachEntry(r,(s,n)=>{e(_r(s),n,t,0)}),t}return null}var Le=Rr;function Ir(r,e,t){if(c.isString(r))try{return(e||JSON.parse)(r),c.trim(r)}catch(s){if(s.name!=="SyntaxError")throw s}return(t||JSON.stringify)(r)}var Ye={transitional:_e,adapter:I.isNode?"http":"xhr",transformRequest:[function(e,t){let s=t.getContentType()||"",n=s.indexOf("application/json")>-1,o=c.isObject(e);if(o&&c.isHTMLForm(e)&&(e=new FormData(e)),c.isFormData(e))return n&&n?JSON.stringify(Le(e)):e;if(c.isArrayBuffer(e)||c.isBuffer(e)||c.isStream(e)||c.isFile(e)||c.isBlob(e))return e;if(c.isArrayBufferView(e))return e.buffer;if(c.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(o){if(s.indexOf("application/x-www-form-urlencoded")>-1)return Ve(e,this.formSerializer).toString();if((l=c.isFileList(e))||s.indexOf("multipart/form-data")>-1){let h=this.env&&this.env.FormData;return y(l?{"files[]":e}:e,h&&new h,this.formSerializer)}}return o||n?(t.setContentType("application/json",!1),Ir(e)):e}],transformResponse:[function(e){let t=this.transitional||Ye.transitional,s=t&&t.forcedJSONParsing,n=this.responseType==="json";if(e&&c.isString(e)&&(s&&!this.responseType||n)){let a=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(l){if(a)throw l.name==="SyntaxError"?m.from(l,m.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:I.classes.FormData,Blob:I.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};c.forEach(["delete","get","head","post","put","patch"],r=>{Ye.headers[r]={}});var k=Ye;var Sr=c.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),_t=r=>{let e={},t,s,n;return r&&r.split(`
`).forEach(function(a){n=a.indexOf(":"),t=a.substring(0,n).trim().toLowerCase(),s=a.substring(n+1).trim(),!(!t||e[t]&&Sr[t])&&(t==="set-cookie"?e[t]?e[t].push(s):e[t]=[s]:e[t]=e[t]?e[t]+", "+s:s)}),e};var Lt=Symbol("internals");function K(r){return r&&String(r).trim().toLowerCase()}function Re(r){return r===!1||r==null?r:c.isArray(r)?r.map(Re):String(r)}function Or(r){let e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,s;for(;s=t.exec(r);)e[s[1]]=s[2];return e}var Cr=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function Be(r,e,t,s,n){if(c.isFunction(s))return s.call(this,e,t);if(n&&(e=t),!!c.isString(e)){if(c.isString(s))return e.indexOf(s)!==-1;if(c.isRegExp(s))return s.test(e)}}function Dr(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}function Nr(r,e){let t=c.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(r,s+t,{value:function(n,o,a){return this[s].call(this,e,n,o,a)},configurable:!0})})}var W=class{constructor(e){e&&this.set(e)}set(e,t,s){let n=this;function o(l,h,u){let d=K(h);if(!d)throw new Error("header name must be a non-empty string");let E=c.findKey(n,d);(!E||n[E]===void 0||u===!0||u===void 0&&n[E]!==!1)&&(n[E||h]=Re(l))}let a=(l,h)=>c.forEach(l,(u,d)=>o(u,d,h));return c.isPlainObject(e)||e instanceof this.constructor?a(e,t):c.isString(e)&&(e=e.trim())&&!Cr(e)?a(_t(e),t):e!=null&&o(t,e,s),this}get(e,t){if(e=K(e),e){let s=c.findKey(this,e);if(s){let n=this[s];if(!t)return n;if(t===!0)return Or(n);if(c.isFunction(t))return t.call(this,n,s);if(c.isRegExp(t))return t.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=K(e),e){let s=c.findKey(this,e);return!!(s&&this[s]!==void 0&&(!t||Be(this,this[s],s,t)))}return!1}delete(e,t){let s=this,n=!1;function o(a){if(a=K(a),a){let l=c.findKey(s,a);l&&(!t||Be(s,s[l],l,t))&&(delete s[l],n=!0)}}return c.isArray(e)?e.forEach(o):o(e),n}clear(e){let t=Object.keys(this),s=t.length,n=!1;for(;s--;){let o=t[s];(!e||Be(this,this[o],o,e,!0))&&(delete this[o],n=!0)}return n}normalize(e){let t=this,s={};return c.forEach(this,(n,o)=>{let a=c.findKey(s,o);if(a){t[a]=Re(n),delete t[o];return}let l=e?Dr(o):String(o).trim();l!==o&&delete t[o],t[l]=Re(n),s[l]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){let t=Object.create(null);return c.forEach(this,(s,n)=>{s!=null&&s!==!1&&(t[n]=e&&c.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){let s=new this(e);return t.forEach(n=>s.set(n)),s}static accessor(e){let s=(this[Lt]=this[Lt]={accessors:{}}).accessors,n=this.prototype;function o(a){let l=K(a);s[l]||(Nr(n,a),s[l]=!0)}return c.isArray(e)?e.forEach(o):o(e),this}};W.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);c.reduceDescriptors(W.prototype,({value:r},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>r,set(s){this[t]=s}}});c.freezeMethods(W);var S=W;function $(r,e){let t=this||k,s=e||t,n=S.from(s.headers),o=s.data;return c.forEach(r,function(l){o=l.call(t,o,n.normalize(),e?e.status:void 0)}),n.normalize(),o}function z(r){return!!(r&&r.__CANCEL__)}function Rt(r,e,t){m.call(this,r??"canceled",m.ERR_CANCELED,e,t),this.name="CanceledError"}c.inherits(Rt,m,{__CANCEL__:!0});var w=Rt;function ke(r,e,t){let s=t.config.validateStatus;!t.status||!s||s(t.status)?r(t):e(new m("Request failed with status code "+t.status,[m.ERR_BAD_REQUEST,m.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}var It=I.isStandardBrowserEnv?function(){return{write:function(t,s,n,o,a,l){let h=[];h.push(t+"="+encodeURIComponent(s)),c.isNumber(n)&&h.push("expires="+new Date(n).toGMTString()),c.isString(o)&&h.push("path="+o),c.isString(a)&&h.push("domain="+a),l===!0&&h.push("secure"),document.cookie=h.join("; ")},read:function(t){let s=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return s?decodeURIComponent(s[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function je(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function qe(r,e){return e?r.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):r}function X(r,e){return r&&!je(e)?qe(r,e):e}var St=I.isStandardBrowserEnv?function(){let e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a"),s;function n(o){let a=o;return e&&(t.setAttribute("href",a),a=t.href),t.setAttribute("href",a),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return s=n(window.location.href),function(a){let l=c.isString(a)?n(a):a;return l.protocol===s.protocol&&l.host===s.host}}():function(){return function(){return!0}}();function ve(r){let e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function Fr(r,e){r=r||10;let t=new Array(r),s=new Array(r),n=0,o=0,a;return e=e!==void 0?e:1e3,function(h){let u=Date.now(),d=s[o];a||(a=u),t[n]=h,s[n]=u;let E=o,R=0;for(;E!==n;)R+=t[E++],E=E%r;if(n=(n+1)%r,n===o&&(o=(o+1)%r),u-a<e)return;let _=d&&u-d;return _?Math.round(R*1e3/_):void 0}}var Ot=Fr;function Ct(r,e){let t=0,s=Ot(50,250);return n=>{let o=n.loaded,a=n.lengthComputable?n.total:void 0,l=o-t,h=s(l),u=o<=a;t=o;let d={loaded:o,total:a,progress:a?o/a:void 0,bytes:l,rate:h||void 0,estimated:h&&a&&u?(a-o)/h:void 0,event:n};d[e?"download":"upload"]=!0,r(d)}}var Pr=typeof XMLHttpRequest!="undefined",Dt=Pr&&function(r){return new Promise(function(t,s){let n=r.data,o=S.from(r.headers).normalize(),a=r.responseType,l;function h(){r.cancelToken&&r.cancelToken.unsubscribe(l),r.signal&&r.signal.removeEventListener("abort",l)}c.isFormData(n)&&(I.isStandardBrowserEnv||I.isStandardBrowserWebWorkerEnv?o.setContentType(!1):o.setContentType("multipart/form-data;",!1));let u=new XMLHttpRequest;if(r.auth){let _=r.auth.username||"",f=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";o.set("Authorization","Basic "+btoa(_+":"+f))}let d=X(r.baseURL,r.url);u.open(r.method.toUpperCase(),G(d,r.params,r.paramsSerializer),!0),u.timeout=r.timeout;function E(){if(!u)return;let _=S.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders()),T={data:!a||a==="text"||a==="json"?u.responseText:u.response,status:u.status,statusText:u.statusText,headers:_,config:r,request:u};ke(function(C){t(C),h()},function(C){s(C),h()},T),u=null}if("onloadend"in u?u.onloadend=E:u.onreadystatechange=function(){!u||u.readyState!==4||u.status===0&&!(u.responseURL&&u.responseURL.indexOf("file:")===0)||setTimeout(E)},u.onabort=function(){!u||(s(new m("Request aborted",m.ECONNABORTED,r,u)),u=null)},u.onerror=function(){s(new m("Network Error",m.ERR_NETWORK,r,u)),u=null},u.ontimeout=function(){let f=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded",T=r.transitional||_e;r.timeoutErrorMessage&&(f=r.timeoutErrorMessage),s(new m(f,T.clarifyTimeoutError?m.ETIMEDOUT:m.ECONNABORTED,r,u)),u=null},I.isStandardBrowserEnv){let _=(r.withCredentials||St(d))&&r.xsrfCookieName&&It.read(r.xsrfCookieName);_&&o.set(r.xsrfHeaderName,_)}n===void 0&&o.setContentType(null),"setRequestHeader"in u&&c.forEach(o.toJSON(),function(f,T){u.setRequestHeader(T,f)}),c.isUndefined(r.withCredentials)||(u.withCredentials=!!r.withCredentials),a&&a!=="json"&&(u.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&u.addEventListener("progress",Ct(r.onDownloadProgress,!0)),typeof r.onUploadProgress=="function"&&u.upload&&u.upload.addEventListener("progress",Ct(r.onUploadProgress)),(r.cancelToken||r.signal)&&(l=_=>{!u||(s(!_||_.type?new w(null,r,u):_),u.abort(),u=null)},r.cancelToken&&r.cancelToken.subscribe(l),r.signal&&(r.signal.aborted?l():r.signal.addEventListener("abort",l)));let R=ve(d);if(R&&I.protocols.indexOf(R)===-1){s(new m("Unsupported protocol "+R+":",m.ERR_BAD_REQUEST,r));return}u.send(n||null)})};var Ie={http:Te,xhr:Dt};c.forEach(Ie,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});var Se={getAdapter:r=>{r=c.isArray(r)?r:[r];let{length:e}=r,t,s;for(let n=0;n<e&&(t=r[n],!(s=c.isString(t)?Ie[t.toLowerCase()]:t));n++);if(!s)throw s===!1?new m(`Adapter ${t} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(c.hasOwnProp(Ie,t)?`Adapter '${t}' is not available in the build`:`Unknown adapter '${t}'`);if(!c.isFunction(s))throw new TypeError("adapter is not a function");return s},adapters:Ie};function Je(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new w(null,r)}function Oe(r){return Je(r),r.headers=S.from(r.headers),r.data=$.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),Se.getAdapter(r.adapter||k.adapter)(r).then(function(s){return Je(r),s.data=$.call(r,r.transformResponse,s),s.headers=S.from(s.headers),s},function(s){return z(s)||(Je(r),s&&s.response&&(s.response.data=$.call(r,r.transformResponse,s.response),s.response.headers=S.from(s.response.headers))),Promise.reject(s)})}var Nt=r=>r instanceof S?r.toJSON():r;function P(r,e){e=e||{};let t={};function s(u,d,E){return c.isPlainObject(u)&&c.isPlainObject(d)?c.merge.call({caseless:E},u,d):c.isPlainObject(d)?c.merge({},d):c.isArray(d)?d.slice():d}function n(u,d,E){if(c.isUndefined(d)){if(!c.isUndefined(u))return s(void 0,u,E)}else return s(u,d,E)}function o(u,d){if(!c.isUndefined(d))return s(void 0,d)}function a(u,d){if(c.isUndefined(d)){if(!c.isUndefined(u))return s(void 0,u)}else return s(void 0,d)}function l(u,d,E){if(E in e)return s(u,d);if(E in r)return s(void 0,u)}let h={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:l,headers:(u,d)=>n(Nt(u),Nt(d),!0)};return c.forEach(Object.keys(Object.assign({},r,e)),function(d){let E=h[d]||n,R=E(r[d],e[d],d);c.isUndefined(R)&&E!==l||(t[d]=R)}),t}var Ce="1.5.0";var Ge={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{Ge[r]=function(s){return typeof s===r||"a"+(e<1?"n ":" ")+r}});var Ft={};Ge.transitional=function(e,t,s){function n(o,a){return"[Axios v"+Ce+"] Transitional option '"+o+"'"+a+(s?". "+s:"")}return(o,a,l)=>{if(e===!1)throw new m(n(a," has been removed"+(t?" in "+t:"")),m.ERR_DEPRECATED);return t&&!Ft[a]&&(Ft[a]=!0,console.warn(n(a," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(o,a,l):!0}};function br(r,e,t){if(typeof r!="object")throw new m("options must be an object",m.ERR_BAD_OPTION_VALUE);let s=Object.keys(r),n=s.length;for(;n-- >0;){let o=s[n],a=e[o];if(a){let l=r[o],h=l===void 0||a(l,o,r);if(h!==!0)throw new m("option "+o+" must be "+h,m.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new m("Unknown option "+o,m.ERR_BAD_OPTION)}}var De={assertOptions:br,validators:Ge};var U=De.validators,Q=class{constructor(e){this.defaults=e,this.interceptors={request:new He,response:new He}}request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=P(this.defaults,t);let{transitional:s,paramsSerializer:n,headers:o}=t;s!==void 0&&De.assertOptions(s,{silentJSONParsing:U.transitional(U.boolean),forcedJSONParsing:U.transitional(U.boolean),clarifyTimeoutError:U.transitional(U.boolean)},!1),n!=null&&(c.isFunction(n)?t.paramsSerializer={serialize:n}:De.assertOptions(n,{encode:U.function,serialize:U.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=o&&c.merge(o.common,o[t.method]);o&&c.forEach(["delete","get","head","post","put","patch","common"],f=>{delete o[f]}),t.headers=S.concat(a,o);let l=[],h=!0;this.interceptors.request.forEach(function(T){typeof T.runWhen=="function"&&T.runWhen(t)===!1||(h=h&&T.synchronous,l.unshift(T.fulfilled,T.rejected))});let u=[];this.interceptors.response.forEach(function(T){u.push(T.fulfilled,T.rejected)});let d,E=0,R;if(!h){let f=[Oe.bind(this),void 0];for(f.unshift.apply(f,l),f.push.apply(f,u),R=f.length,d=Promise.resolve(t);E<R;)d=d.then(f[E++],f[E++]);return d}R=l.length;let _=t;for(E=0;E<R;){let f=l[E++],T=l[E++];try{_=f(_)}catch(F){T.call(this,F);break}}try{d=Oe.call(this,_)}catch(f){return Promise.reject(f)}for(E=0,R=u.length;E<R;)d=d.then(u[E++],u[E++]);return d}getUri(e){e=P(this.defaults,e);let t=X(e.baseURL,e.url);return G(t,e.params,e.paramsSerializer)}};c.forEach(["delete","get","head","options"],function(e){Q.prototype[e]=function(t,s){return this.request(P(s||{},{method:e,url:t,data:(s||{}).data}))}});c.forEach(["post","put","patch"],function(e){function t(s){return function(o,a,l){return this.request(P(l||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:o,data:a}))}}Q.prototype[e]=t(),Q.prototype[e+"Form"]=t(!0)});var Z=Q;var Ne=class{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(o){t=o});let s=this;this.promise.then(n=>{if(!s._listeners)return;let o=s._listeners.length;for(;o-- >0;)s._listeners[o](n);s._listeners=null}),this.promise.then=n=>{let o,a=new Promise(l=>{s.subscribe(l),o=l}).then(n);return a.cancel=function(){s.unsubscribe(o)},a},e(function(o,a,l){s.reason||(s.reason=new w(o,a,l),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;let t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new Ne(function(n){e=n}),cancel:e}}},Pt=Ne;function Ke(r){return function(t){return r.apply(null,t)}}function We(r){return c.isObject(r)&&r.isAxiosError===!0}var $e={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries($e).forEach(([r,e])=>{$e[e]=r});var bt=$e;function gt(r){let e=new Z(r),t=q(Z.prototype.request,e);return c.extend(t,Z.prototype,e,{allOwnKeys:!0}),c.extend(t,e,null,{allOwnKeys:!0}),t.create=function(n){return gt(P(r,n))},t}var L=gt(k);L.Axios=Z;L.CanceledError=w;L.CancelToken=Pt;L.isCancel=z;L.VERSION=Ce;L.toFormData=y;L.AxiosError=m;L.Cancel=L.CanceledError;L.all=function(e){return Promise.all(e)};L.spread=Ke;L.isAxiosError=We;L.mergeConfig=P;L.AxiosHeaders=S;L.formToJSON=r=>Le(c.isHTMLForm(r)?new FormData(r):r);L.getAdapter=Se.getAdapter;L.HttpStatusCode=bt;L.default=L;var ze=L;var Fe=class{constructor(e,t){this.url=e,this.token=null,this.messageCallback=t}getCorrelationId(e){if(typeof e!="string")return null;var t;try{t=e&&JSON.parse(e)}catch{return null}if(t&&t[0]&&t[0][i.FIELD.CORRELATION_ID])return t[0][i.FIELD.CORRELATION_ID]}send(e){if(this.token===null)throw new Error("HTTP Connection not yet authenticated. Call authenticate() first.");ze({url:this.url,method:"post",responseType:"json",responseEncoding:"utf8",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"},data:e}).then(t=>{e.includes(i.ACTION.SET)&&JSON.parse(e).forEach(n=>{n[i.FIELD.ACTION]===i.ACTION.SET&&t.data.push({[i.FIELD.CORRELATION_ID]:n[i.FIELD.CORRELATION_ID],[i.FIELD.RESULT]:i.RESULT.SUCCESS})}),this.messageCallback(t)}).catch(t=>{let s={[i.FIELD.RESULT]:i.RESULT.ERROR},n=this.getCorrelationId(e);n&&(s[i.FIELD.CORRELATION_ID]=n),t.response&&t.response.data?typeof t.response.data=="object"?(s[i.FIELD.ERROR]=t.response.data[i.FIELD.ERROR],s[i.FIELD.ERROR_CODE]=t.response.data[i.FIELD.ERROR_CODE]):s[i.FIELD.ERROR]=t.response.data:s[i.FIELD.ERROR]=t.message||t.body||t.toString(),this.messageCallback({data:[s]})})}close(){}};var ee=class extends b{constructor(e){super();this.constants=i,this.connectionStatus=i.CONNECTION_STATUS.DISCONNECTED,this.ping=null,this.version="1.10.5",this.serverVersion=null,this.serverBuildDate=null,this.mode=null,this.token=null,this.options=this._extendOptions(e,{outgoingMessageBufferTime:0,logMessages:!1,logErrors:!0,adminDashboardBasePath:"/admin/",heartbeatInterval:6e4,reconnectInterval:1e3,maxReconnectAttempts:1/0,httpRoot:null}),this.system=new re(this),this.realm=new de(this),this._subscription=new fe(this),this._url=null,this._connection=null,this._reconnectTimeout=null,this._reconnectAttempts=0,this._onConnectPromise=null,this._onAuthenticatePromise=null,this._onDisconnectPromise=null,this._pendingRequests={},this._pendingMessages=null,this._pendingHeartbeats={},this._typeHandler={[i.TYPE.SYSTEM]:this.system,[i.TYPE.SUBSCRIPTION]:this._subscription,[i.TYPE.REALM]:this.realm}}useHTTP(e){if(this.mode==i.MODE.WS)throw new Error("Can't use HTTP. This client is already connected via Websocket.");clearInterval(this._heartbeatInterval),this.mode=i.MODE.HTTP,this._url=e,this._connection=new Fe(e,this._onMessage.bind(this))}connect(e){if(this.mode===i.MODE.HTTP)throw new Error("Can't connect via Websocket. This client is already using HTTP");if(this.mode===i.MODE.WS&&this._connection.readyState===this.WsConstructor.OPEN)throw new Error("This client is already connected");return this.mode=i.MODE.WS,this._url=e,this._changeConnectionStatus(i.CONNECTION_STATUS.CONNECTING),this._connection=new this.WsConstructor(e),this._connection.onopen=this._onOpen.bind(this),this._connection.onclose=this._onClose.bind(this),this._connection.onerror=t=>{this._onError(t.message,i.ERROR.CONNECTION_ERROR)},this._connection.onmessage=this._onMessage.bind(this),this._onConnectPromise||(this._onConnectPromise=x()),this._onConnectPromise}authenticate(e){return this._connection?this.mode===i.MODE.HTTP?(this._connection.token=e,this.connectionStatus=i.CONNECTION_STATUS.AUTHENTICATED,Promise.resolve()):(this.token=e,this.system._sendAuthMessage(e),this._onAuthenticatePromise=x(),this._onAuthenticatePromise):Promise.reject("can't authenticate: client not connected. Did you call .connect() before calling .authenticate()?")}disconnect(){return this._connection?(this._changeConnectionStatus(i.CONNECTION_STATUS.DISCONNECTING),this._connection.close(),this._onDisconnectPromise=x(),this._onDisconnectPromise):Promise.reject("client not connected")}getId(e){return e+"-"+ye()}getURL(){return this._connection.url}_onOpen(){this._changeConnectionStatus(i.CONNECTION_STATUS.CONNECTED),this._heartbeatInterval=setInterval(this._sendHeartbeatMessage.bind(this),this.options.heartbeatInterval),clearTimeout(this._reconnectTimeout),this._reconnectTimeout=null,this._reconnectAttempts=0,this._onConnectPromise.resolve()}_onDisconnect(){clearInterval(this._heartbeatInterval),this._changeConnectionStatus(i.CONNECTION_STATUS.DISCONNECTED),this._onDisconnectPromise&&this._onDisconnectPromise.resolve()}_onClose(){if(this.connectionStatus===i.CONNECTION_STATUS.DISCONNECTING)this._onDisconnect();else{if(this._reconnectAttempts++,this._reconnectAttempts>this.options.maxReconnectAttempts){let t="exceeded max reconnect attempts. giving up :-(";this._onError(t,i.ERROR.MAX_RECONNECT_ATTEMPTS_EXCEEDED),clearTimeout(this._reconnectTimeout),this._onConnectPromise.reject(t),this._connection.close(),this._onDisconnect();return}let e=`Disconnected, attempting to reconnect. (Attempt ${this._reconnectAttempts} of ${this.options.maxReconnectAttempts})`;this._onError(e,i.ERROR.DISCONNECTED_RETRYING),clearTimeout(this._reconnectTimeout),this._reconnectTimeout=setTimeout(async()=>{await this.connect(this._url),this.token&&await this.authenticate(this.token)},this.options.reconnectInterval)}}_onError(e,t,s){this.emit("error",e,t,s),this.options.logErrors&&console.warn(e,s||"")}_onMessage(e){var t;try{t=typeof e.data=="string"?JSON.parse(e.data):e.data}catch(s){this._onError(`Failed to parse message: ${s} - ${e.data}`,i.ERROR.MESSAGE_PARSE_ERROR)}Array.isArray(t)?t.forEach(this._handleIncomingMessage.bind(this)):this._onError(`message was not in expected form: ${JSON.stringify(t)}`,i.ERROR.MESSAGE_PARSE_ERROR)}_sendMessage(e){this._pendingMessages===null?(this._pendingMessages=[e],this.connectionStatus===i.CONNECTION_STATUS.AUTHENTICATED?this._sendPendingMessageTimeout=setTimeout(this._sendPendingMessages.bind(this),this.options.outgoingMessageBufferTime):this.options.logErrors&&console.warn("hivekit connection not authenticated. Outgoing messages will be queued until authentication")):this._pendingMessages.push(e)}_sendPendingMessages(){if(!(!this._pendingMessages||this._pendingMessages.length===0)){if(this.options.logMessages)for(let e=0;e<this._pendingMessages.length;e++)console.log(">",this._pendingMessages[e]);this._connection.send(JSON.stringify(this._pendingMessages)),this._pendingMessages=null}}_sendHeartbeatMessage(){if(this.connectionStatus!==i.CONNECTION_STATUS.AUTHENTICATED)return;let e=this.getId("heartbeat");this._pendingHeartbeats[e]=Date.now();let t=[{[i.FIELD.TYPE]:i.TYPE.SYSTEM,[i.FIELD.ACTION]:i.ACTION.HEARTBEAT,[i.FIELD.CORRELATION_ID]:e}];this._connection.send(JSON.stringify(t))}_processHeartbeatResponse(e){this._pendingHeartbeats[e[i.FIELD.CORRELATION_ID]]&&(this.ping=Date.now()-this._pendingHeartbeats[e[i.FIELD.CORRELATION_ID]],this.emit("ping",this.ping)),delete this._pendingHeartbeats[e[i.FIELD.CORRELATION_ID]]}_handleIncomingMessage(e){this.options.logMessages&&console.log("<",e),e[i.FIELD.CORRELATION_ID]?this._pendingHeartbeats[e[i.FIELD.CORRELATION_ID]]?this._processHeartbeatResponse(e):this._pendingRequests[e[i.FIELD.CORRELATION_ID]]?(this._pendingRequests[e[i.FIELD.CORRELATION_ID]].responseCallbacks.forEach(t=>{t(e)}),delete this._pendingRequests[e[i.FIELD.CORRELATION_ID]]):this._onError("Received response for unknown request",i.ERROR.UNKNOWN_REQUEST,e):e[i.FIELD.RESULT]===i.RESULT.ERROR&&e[i.FIELD.TYPE]!==i.TYPE.SYSTEM?this._onError(e[i.FIELD.ERROR]||e[i.FIELD.DATA],i.ERROR.SERVER_ERROR):this._typeHandler[e[i.FIELD.TYPE]]?this._typeHandler[e[i.FIELD.TYPE]]._handleIncomingMessage(e):this._onError("Received message for unknown type "+this._typeHandler[e[i.FIELD.TYPE]],i.ERROR.UNKNOWN_TYPE)}_changeConnectionStatus(e){this.connectionStatus=e,this.emit("connectionStatusChanged",e),e===i.CONNECTION_STATUS.AUTHENTICATED&&this._sendPendingMessages()}_sendRequest(e,t){let s=this._getSignature(e);for(let o in this._pendingRequests)if(this._pendingRequests[o].signature===s){this._pendingRequests[o].responseCallbacks.push(t);return}let n=ye();e[i.FIELD.CORRELATION_ID]=n,this._pendingRequests[n]={signature:s,responseCallbacks:[t]},this._sendMessage(e)}_sendRequestAndHandleResponse(e,t){let s=x();return this._sendRequest(e,n=>{n[i.FIELD.RESULT]===i.RESULT.ERROR?(this._onError(n[i.FIELD.ERROR],i.FIELD.SERVER_ERROR,i.FIELD.ERROR_CODE),s.reject({message:n[i.FIELD.ERROR],code:n[i.FIELD.ERROR_CODE]})):s.resolve(t?t(n):n)}),s}_getSignature(...e){let t=JSON.stringify(e),s=0,n=0;for(s;s<t.length;s++)n=(n<<5)-n+t.charCodeAt(s),n=n&n;return n}_extendOptions(e,t,s){if(!e)return t;s&&(e=this._compressFields(e,s));let n={};for(let o in t)typeof e[o]!="undefined"?n[o]=e[o]:n[o]=t[o];return n}_extendFields(e,t=A.FIELD){let s={};for(let n in e)t[n]?n===i.FIELD.LOCATION?s[t[n]]=this._extendFields(e[n],A.LOCATION):n===i.FIELD.STEPS?s[t[n]]=this._extendFieldsArray(e[n],A.FIELD):n===i.FIELD.PRESENCE_CONNECTION_STATUS?s[t[i.FIELD.PRESENCE_CONNECTION_STATUS]]=A.PRESENCE_CONNECTION_STATUS[e[n]]:n===i.FIELD.SUB_TYPE&&e[i.FIELD.SHAPE]?s[t[i.FIELD.SHAPE]]=A.SHAPE_TYPE[e[n]]:n===i.FIELD.SHAPE?s[t[i.FIELD.SHAPE_DATA]]=e[n]:n===i.FIELD.TYPE?s[t[i.FIELD.TYPE]]=A.TYPE[e[n]]:n===i.FIELD.FIELD?s[t[i.FIELD.FIELD]]=A.FIELD[e[n]]:s[t[n]]=e[n]:s[n]=e[n];return s}_extendFieldsMap(e){let t={};for(let s in e)t[s]=this._extendFields(e[s]);return t}_extendFieldsArray(e){let t=[];for(let s of e)t.push(this._extendFields(s));return t}_compressFields(e,t,s){let n=Xe(t),o={};for(let a in e)n[a]?o[n[a]]=e[a]:s?o[a]=e[a]:this._onError(`Unknown field ${a}`,i.ERROR.UNKNOWN_FIELD);return o}};ee.prototype.WsConstructor=window.WebSocket;var Uo=ee;export{Uo as default};
